<html>

<head>
    <title>test</title>
    <script type="text/javascript" src="lib.js"></script>
    <script type="text/javascript" src="lib_btc.js"></script>
</head>

<body>
    <form id="generate-address">
        <fieldset>
            <legend>generate-address</legend>
            <input type="button" value="generate" onclick="generateNew();">
            Address: <input name="address" type="text" placeholder="Address" disabled />
            PrivateKey: <input name="private" type="text" placeholder="Private-Key" disabled />
        </fieldset>
    </form>
    <form id="retrieve-address">
        <fieldset>
            <legend>retrieve-address</legend>
            <input name="private" type="text" placeholder="Private-Key" />
            <input type="button" value="retrieve" onclick="retrieveAddress();">
            Address: <input name="address" type="text" placeholder="Address" disabled />
        </fieldset>
    </form>
    <form id="check-balance">
        <fieldset>
            <legend>check-balance</legend>
            <input name="address" type="text" placeholder="Address" />
            <input type="button" value="check" onclick="checkBalance();">
            <div>Balance: <input name="balance" disabled /></div>
        </fieldset>
    </form>
    <form id="send-tx">
        <fieldset>
            <legend>send-tx</legend>
            <input name="sender" type="text" placeholder="Sender" />
            <input name="receiver" type="text" placeholder="Receiver" />
            <input name="amount" type="number" placeholder="Amount" />
            <input name="fee" type="number" placeholder="fee" step="0.0001" />
            <input type="button" value="send" onclick="sendTx();">
        </fieldset>
    </form>
</body>
<script>
    function generateNew() {
        let newKeys = btc_api.newKeys;
        let form = document.forms['generate-address'];
        form['private'].value = newKeys.privkey;
        form['address'].value = newKeys.address;
    }

    function retrieveAddress() {
        let form = document.forms['retrieve-address'];
        form['address'].value = btc_api.address(form['private'].value);
    }

    function checkBalance() {
        let form = document.forms['check-balance'];
        let address = form["address"].value;
        btc_api.getBalance(address)
            .then(result => form["balance"].value = result)
            .catch(error => console.error(error))
    }

    function sendTx() {
        let form = document.forms['send-tx'];
        let sender = form["sender"].value,
            receiver = form["receiver"].value,
            amount = parseFloat(form["amount"].value),
            fee = parseFloat(form["fee"].value);
        let privKey = prompt("Enter Private Key:");
        btc_api.sendTx(sender, privKey, receiver, amount, fee).then(result => {
            console.log(result);
            alert("transaction id: " + result.txid);
        }).catch(error => console.error(error))
    }
</script>

</html>